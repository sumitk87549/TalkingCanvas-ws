<div class="dashboard-container">
  <div class="header">
    <h1>üé® Admin Dashboard</h1>
    <button routerLink="add" class="add-btn" *ngIf="activeTabIndex === 1">
      <span class="icon">+</span> Add New Painting
    </button>
  </div>

  <!-- Dashboard Stats Overview -->
  <div class="stats-overview" *ngIf="dashboardStats">
    <div class="stat-card revenue">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatCurrency(dashboardStats.totalRevenue) }}</div>
        <div class="stat-label">Total Revenue</div>
        <div class="stat-sub">This Month: {{ formatCurrency(dashboardStats.revenueThisMonth) }}</div>
      </div>
    </div>
    <div class="stat-card orders">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <div class="stat-value">{{ dashboardStats.totalOrders }}</div>
        <div class="stat-label">Total Orders</div>
        <div class="stat-sub">Pending: {{ dashboardStats.pendingOrders }}</div>
      </div>
    </div>
    <div class="stat-card users">
      <div class="stat-icon">üë•</div>
      <div class="stat-content">
        <div class="stat-value">{{ dashboardStats.totalUsers }}</div>
        <div class="stat-label">Total Users</div>
        <div class="stat-sub">Active: {{ dashboardStats.activeUsers }}</div>
      </div>
    </div>
    <div class="stat-card paintings">
      <div class="stat-icon">üñºÔ∏è</div>
      <div class="stat-content">
        <div class="stat-value">{{ dashboardStats.totalPaintings }}</div>
        <div class="stat-label">Total Paintings</div>
        <div class="stat-sub">Available: {{ dashboardStats.availablePaintings }}</div>
      </div>
    </div>
  </div>

  <mat-tab-group [(selectedIndex)]="activeTabIndex" class="dashboard-tabs">
    <!-- Overview Tab -->
    <mat-tab label="üìä Overview">
      <div class="content-section">
        <h2>Quick Statistics</h2>

        <div *ngIf="loadingStats" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading statistics...</p>
        </div>

        <div *ngIf="!loadingStats && dashboardStats" class="overview-grid">
          <div class="overview-card">
            <h3>üì¶ Order Status Distribution</h3>
            <div class="status-grid">
              <div class="status-item pending">
                <span class="count">{{ dashboardStats.pendingOrders }}</span>
                <span class="label">Pending</span>
              </div>
              <div class="status-item confirmed">
                <span class="count">{{ dashboardStats.confirmedOrders }}</span>
                <span class="label">Confirmed</span>
              </div>
              <div class="status-item shipped">
                <span class="count">{{ dashboardStats.shippedOrders }}</span>
                <span class="label">Shipped</span>
              </div>
              <div class="status-item delivered">
                <span class="count">{{ dashboardStats.deliveredOrders }}</span>
                <span class="label">Delivered</span>
              </div>
              <div class="status-item cancelled">
                <span class="count">{{ dashboardStats.cancelledOrders }}</span>
                <span class="label">Cancelled</span>
              </div>
            </div>
          </div>

          <div class="overview-card">
            <h3>üí∞ Revenue Summary</h3>
            <div class="revenue-stats">
              <div class="revenue-item">
                <span class="label">This Month</span>
                <span class="amount">{{ formatCurrency(dashboardStats.revenueThisMonth) }}</span>
              </div>
              <div class="revenue-item">
                <span class="label">This Year</span>
                <span class="amount">{{ formatCurrency(dashboardStats.revenueThisYear) }}</span>
              </div>
              <div class="revenue-item total">
                <span class="label">All Time</span>
                <span class="amount">{{ formatCurrency(dashboardStats.totalRevenue) }}</span>
              </div>
            </div>
          </div>

          <div class="overview-card">
            <h3>üñºÔ∏è Inventory Status</h3>
            <div class="inventory-stats">
              <div class="inventory-item">
                <span class="count available">{{ dashboardStats.availablePaintings }}</span>
                <span class="label">Available</span>
              </div>
              <div class="inventory-item">
                <span class="count out-of-stock">{{ dashboardStats.outOfStockPaintings }}</span>
                <span class="label">Out of Stock</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- Paintings Tab -->
    <mat-tab label="üñºÔ∏è Paintings">
      <div class="content-section">
        <h2>Painting Inventory</h2>

        <div *ngIf="loading" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading paintings...</p>
        </div>

        <div *ngIf="!loading && paintings.length === 0" class="empty-state">
          <p>No paintings found. Add your first painting!</p>
        </div>

        <div *ngIf="!loading && paintings.length > 0" class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Image</th>
                <th>Title</th>
                <th>Artist</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Views</th>
                <th>Sales</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let painting of paintings">
                <td class="image-cell">
                  <img [src]="painting.images?.[0]?.imageUrl || 'assets/images/placeholder-painting.jpg'"
                    alt="{{ painting.title }}" class="thumbnail">
                </td>
                <td class="title-cell">{{ painting.title }}</td>
                <td>{{ painting.artistName }}</td>
                <td>{{ painting.currency }} {{ painting.price }}</td>
                <td>{{ painting.stockQuantity }}</td>
                <td>{{ painting.viewCount || 0 }}</td>
                <td>{{ painting.purchaseCount || 0 }}</td>
                <td>
                  <span class="status-badge" [class.available]="painting.isAvailable"
                    [class.sold-out]="!painting.isAvailable">
                    {{ painting.isAvailable ? 'Available' : 'Sold Out' }}
                  </span>
                </td>
                <td class="actions-cell">
                  <button (click)="editPainting(painting.id)" class="action-btn edit" title="Edit">
                    ‚úèÔ∏è
                  </button>
                  <button (click)="deletePainting(painting.id, painting.title)" class="action-btn delete"
                    title="Delete">
                    üóëÔ∏è
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </mat-tab>

    <!-- Orders Tab -->
    <mat-tab label="üì¶ Orders">
      <div class="content-section">
        <h2>Order Management</h2>

        <div *ngIf="loadingOrders" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading orders...</p>
        </div>

        <div *ngIf="!loadingOrders && orders.length === 0" class="empty-state">
          <p>No orders found. Orders will appear here when customers place them.</p>
        </div>

        <div *ngIf="!loadingOrders && orders.length > 0" class="table-container">
          <table class="data-table orders-table">
            <thead>
              <tr>
                <th>Order Details</th>
                <th>Customer</th>
                <th>Delivery Address</th>
                <th>Items</th>
                <th>Total</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of orders">
                <td>
                  <span class="order-number">{{ order.orderNumber }}</span>
                  <div class="date-sub">{{ order.createdAt | date:'medium' }}</div>
                </td>
                <td>
                  <div class="user-info">
                    <span class="name">{{ order.user?.name || 'Unknown' }}</span>
                    <span class="email">{{ order.user?.email || 'No Email' }}</span>
                  </div>
                </td>
                <td>
                  <div class="contact-info">
                    <p class="address-line">{{ order.deliveryAddress?.street }}</p>
                    <p class="address-line">{{ order.deliveryAddress?.city }}, {{ order.deliveryAddress?.state }}</p>
                    <p class="address-line">{{ order.deliveryAddress?.country }} - {{ order.deliveryAddress?.pincode }}
                    </p>
                    <p class="notes" *ngIf="order.notes">üìù {{ order.notes }}</p>
                  </div>
                </td>
                <td>
                  <ul class="painting-list">
                    <li *ngFor="let item of order.items">
                      <span class="item-title">{{ item.paintingTitle }}</span>
                      <span class="item-qty">x{{ item.quantity }}</span>
                    </li>
                  </ul>
                </td>
                <td>
                  <div class="amount-info">
                    <span class="total">{{ order.currency }} {{ order.totalAmount }}</span>
                    <span class="payment-method-badge" [class.cod]="order.paymentMethod === 'COD'">
                      {{ order.paymentMethod }}
                    </span>
                  </div>
                </td>
                <td>
                  <span class="status-badge" [ngClass]="order.orderStatus?.toLowerCase()">
                    {{ order.orderStatus }}
                  </span>
                </td>
                <td class="actions-cell">
                  <select class="status-select" [value]="order.orderStatus"
                    (change)="updateOrderStatus(order.id, $any($event.target).value)">
                    <option *ngFor="let status of orderStatuses" [value]="status">{{ status }}</option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </mat-tab>

    <!-- Users Tab -->
    <mat-tab label="üë• Users">
      <div class="content-section">
        <h2>User Management</h2>

        <div *ngIf="loadingUsers" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading users...</p>
        </div>

        <div *ngIf="!loadingUsers && users.length === 0" class="empty-state">
          <p>No users found.</p>
        </div>

        <div *ngIf="!loadingUsers && users.length > 0" class="table-container">
          <table class="data-table users-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Joined</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users" [class.inactive]="!user.isActive">
                <td>
                  <div class="user-cell">
                    <span class="emoji">{{ user.profileEmoji || 'üë§' }}</span>
                    <span class="name">{{ user.name }}</span>
                  </div>
                </td>
                <td>{{ user.email }}</td>
                <td>
                  <span class="role-badge" [class.admin]="user.role === 'ADMIN'" [class.user]="user.role === 'USER'">
                    {{ user.role }}
                  </span>
                </td>
                <td>
                  <span class="status-badge" [class.active]="user.isActive" [class.inactive-badge]="!user.isActive">
                    {{ user.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td>{{ user.createdAt | date:'shortDate' }}</td>
                <td class="actions-cell">
                  <button (click)="toggleUserStatus(user.id, user.name, user.isActive)" class="action-btn toggle"
                    [class.disable]="user.isActive" [class.enable]="!user.isActive"
                    [title]="user.isActive ? 'Disable User' : 'Enable User'">
                    {{ user.isActive ? 'üîí' : 'üîì' }}
                  </button>
                  <button *ngIf="user.role !== 'ADMIN'" (click)="promoteToAdmin(user.id, user.name)"
                    class="action-btn promote" title="Promote to Admin">
                    üëë
                  </button>
                  <button (click)="deleteUser(user.id, user.name)" class="action-btn delete" title="Delete User">
                    üóëÔ∏è
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </mat-tab>

    <!-- System Metrics Tab -->
    <mat-tab label="‚öôÔ∏è System">
      <div class="content-section">
        <h2>System Health & Metrics</h2>

        <div *ngIf="loadingMetrics" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading system metrics...</p>
        </div>

        <div *ngIf="!loadingMetrics" class="metrics-container">
          <!-- Health Status -->
          <mat-card class="metric-card">
            <mat-card-header>
              <mat-card-title>Application Health</mat-card-title>
              <mat-card-subtitle>Current system health status</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="health-status" [ngClass]="getEffectiveHealthStatus().toLowerCase()">
                <div class="status-indicator"></div>
                <div class="status-text">
                  <h3>{{ getEffectiveHealthStatus() }}</h3>
                  <p *ngIf="getEffectiveHealthStatus() === 'UP'">All critical systems operational</p>
                  <p *ngIf="getEffectiveHealthStatus() === 'DOWN'">Some services may be experiencing issues</p>
                  <p *ngIf="getEffectiveHealthStatus() === 'UNKNOWN'">Unable to determine health status</p>
                </div>
              </div>

              <div class="health-details" *ngIf="healthStatus?.components">
                <h4>Component Status</h4>
                <div class="component" *ngFor="let component of getHealthComponents()">
                  <span class="component-name">{{ component.name }}:</span>
                  <span class="component-status" [ngClass]="component.status.toLowerCase()">
                    {{ component.status }}
                    <span *ngIf="component.name === 'mail' && component.status === 'DOWN'"
                      class="non-critical">(non-critical)</span>
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- JVM Metrics -->
          <mat-card class="metric-card" *ngIf="jvmMetrics.length > 0">
            <mat-card-header>
              <mat-card-title>JVM Metrics</mat-card-title>
              <mat-card-subtitle>Java Virtual Machine statistics</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="metrics-grid">
                <div class="metric-item" *ngFor="let metric of jvmMetrics">
                  <div class="metric-name">{{ metric.name }}</div>
                  <div class="metric-value">{{ formatMetricValue(metric) }}</div>
                  <div class="metric-desc">{{ metric.description }}</div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- HTTP Metrics -->
          <mat-card class="metric-card" *ngIf="httpMetrics.length > 0">
            <mat-card-header>
              <mat-card-title>HTTP Request Metrics</mat-card-title>
              <mat-card-subtitle>HTTP request statistics</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="metrics-grid">
                <div class="metric-item" *ngFor="let metric of httpMetrics">
                  <div class="metric-name">{{ metric.name }}</div>
                  <div class="metric-value">{{ formatMetricValue(metric) }}</div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Database Metrics -->
          <mat-card class="metric-card" *ngIf="dbMetrics.length > 0">
            <mat-card-header>
              <mat-card-title>Database Metrics</mat-card-title>
              <mat-card-subtitle>Database connection statistics</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="metrics-grid">
                <div class="metric-item" *ngFor="let metric of dbMetrics">
                  <div class="metric-name">{{ metric.name }}</div>
                  <div class="metric-value">{{ formatMetricValue(metric) }}</div>
                  <div class="metric-desc">{{ metric.description }}</div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="confirm-modal" [class.danger]="confirmModalDanger" (click)="$event.stopPropagation()">
    <h3>{{ confirmModalTitle }}</h3>
    <p>{{ confirmModalMessage }}</p>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="closeConfirmModal()">Cancel</button>
      <button class="btn-confirm" [class.danger]="confirmModalDanger" (click)="confirmAction()">
        {{ confirmModalDanger ? 'Yes, Proceed' : 'Confirm' }}
      </button>
    </div>
  </div>
</div>