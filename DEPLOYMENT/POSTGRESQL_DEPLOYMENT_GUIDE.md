# Complete PostgreSQL Setup Guide for TalkingCanvas

This guide provides **step-by-step instructions** with exact values, URLs, and credentials you need to set up free PostgreSQL databases and deploy your TalkingCanvas Spring Boot application.

---

## üìñ Related Deployment Guides

This is **Part 1 of 3** in the TalkingCanvas deployment series:

1. **[POSTGRESQL_DEPLOYMENT_GUIDE.md](POSTGRESQL_DEPLOYMENT_GUIDE.md)** - Setup free PostgreSQL database (**You are here**)
2. **[BEGINNER_DEPLOYMENT_GUIDE.md](BEGINNER_DEPLOYMENT_GUIDE.md)** - Deploy Spring Boot backend (Railway/Render/Koyeb)
3. **[ANGULAR_DEPLOYMENT_GUIDE.md](ANGULAR_DEPLOYMENT_GUIDE.md)** - Deploy Angular frontend (Vercel/Netlify/GitHub Pages)

> **üí° Recommended Order**: Database ‚Üí Backend ‚Üí Frontend

---

## üìã Table of Contents

1. [Free PostgreSQL Setup - Supabase](#1-free-postgresql-setup---supabase)
2. [Free PostgreSQL Setup - Aiven](#2-free-postgresql-setup---aiven)
3. [Deployment to Railway](#3-deployment-to-railway)
4. [Deployment to Render](#4-deployment-to-render)
5. [Deployment to Koyeb](#5-deployment-to-koyeb)
6. [Deployment to Google Cloud](#6-deployment-to-google-cloud-run)
7. [Deployment to Oracle Cloud](#7-deployment-to-oracle-cloud)
8. [Environment Variables Reference](#8-environment-variables-reference)
9. [Troubleshooting](#9-troubleshooting)

---

## 1. Free PostgreSQL Setup - Supabase

### Step 1.1: Create Supabase Account
1. Go to **https://supabase.com**
2. Click **"Start your project"**
3. Sign up with **GitHub** (recommended) or Email
4. Verify your email if using email signup

### Step 1.2: Create New Project
1. Click **"New Project"** button
2. Fill in project details:
   - **Name**: `talkingcanvas-db` (or any name you prefer)
   - **Database Password**: Click "Generate a password" or create your own
   - **Region**: Choose closest to your users (e.g., `us-east-1`, `eu-west-1`)
   - **Pricing Plan**: Select **FREE** (500 MB database, 2 GB file storage)
3. Click **"Create new project"**
4. Wait 2-3 minutes for database provisioning

### Step 1.3: Get Database Credentials

**IMPORTANT**: Save these values - you'll need them for deployment!

1. Go to **Project Settings** (gear icon in left sidebar)
2. Click **"Database"** tab
3. Scroll to **"Connection string"** section
4. Find **"Connection string"** and select **"URI"** format

**Example URI format**:
```
postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres
```

**Values to save**:
```
Host: db.xxxxx.supabase.co
Port: 5432
Database: postgres
User: postgres
Password: [the password you set in Step 1.2]
```

### Step 1.4: Connection String for Spring Boot

**For Railway/Render/Koyeb** (use DATABASE_URL):
```
jdbc:postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require
```

**Important Notes**:
- ‚úÖ Keep the `?sslmode=require` at the end
- ‚úÖ Replace `[YOUR-PASSWORD]` with your actual password
- ‚úÖ Keep the `postgres` user (default for Supabase)
- ‚ö†Ô∏è Don't share this URL publicly - it contains your password!

---

## 2. Free PostgreSQL Setup - Aiven

### Step 2.1: Create Aiven Account
1. Go to **https://aiven.io**
2. Click **"Sign up for free"**
3. Sign up with **GitHub** or Email
4. Verify your email

### Step 2.2: Create PostgreSQL Service
1. Click **"Create service"**
2. Select **PostgreSQL**
3. Choose cloud provider:
   - **AWS**, **Google Cloud**, or **Azure**
   - Region: Choose closest to you
4. Select plan: **"Free plan"** ($0/month, 1 CPU, 1 GB RAM, 5 GB storage)
5. Service name: `talkingcanvas-postgres` (or any name)
6. Click **"Create service"**
7. Wait 3-5 minutes for provisioning

### Step 2.3: Get Database Credentials

**Service Overview page shows**:

```
Service URI (copy this entire string):
postgres://avnadmin:[PASSWORD]@[HOST]:[PORT]/defaultdb?sslmode=require
```

**Values to save**:
```
Host: [hostname].aivencloud.com
Port: [usually 12345 or similar]
Database: defaultdb
User: avnadmin
Password: [auto-generated by Aiven]
```

### Step 2.4: Connection String for Spring Boot

**For deployment platforms**:
```
jdbc:postgresql://avnadmin:[PASSWORD]@[HOST]:[PORT]/defaultdb?sslmode=require
```

**Example**:
```
jdbc:postgresql://avnadmin:AVNS_abc123XYZ@pg-talkingcanvas-myproject.aivencloud.com:12345/defaultdb?sslmode=require
```

**Important Notes**:
- ‚úÖ Aiven uses `defaultdb` as default database
- ‚úÖ Username is `avnadmin` (not `postgres`)
- ‚úÖ SSL is required (`?sslmode=require`)
- ‚ö†Ô∏è Service takes 3-5 min to fully start

---

## 3. Deployment to Railway

### Step 3.1: Prerequisites
- ‚úÖ Code pushed to GitHub
- ‚úÖ Railway account (sign up at railway.app)
- ‚úÖ PostgreSQL ready (Supabase or Aiven) OR use Railway's PostgreSQL

### Step 3.2: Option A - Use Railway's PostgreSQL

1. Go to **https://railway.app**
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Choose **`TalkingCanvas-ws`** repository
5. Click **"+ New"** ‚Üí **"Database"** ‚Üí **"PostgreSQL"**
6. Railway automatically creates database

**No manual configuration needed!** Railway provides `DATABASE_URL` automatically.

### Step 3.3: Option B - Use External PostgreSQL (Supabase/Aiven)

Same as Option A, but skip adding Railway's PostgreSQL. You'll manually set `DATABASE_URL` in Step 3.5.

### Step 3.4: Configure Spring Boot Service

1. Click on your **Spring Boot service** (not database)
2. Go to **"Variables"** tab
3. Click **"+ New Variable"**

### Step 3.5: Add Environment Variables

**If using Railway PostgreSQL**:
```bash
SPRING_PROFILES_ACTIVE=prod
DATABASE_URL=${{Postgres.DATABASE_URL}}   # Click + Reference ‚Üí Select PostgreSQL ‚Üí DATABASE_URL
JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT
FRONTEND_URL=https://talking-canvas-ws.vercel.app
ADMIN_EMAIL=pkumar.mail@gmail.com
ADMIN_PASSWORD=Admin@1998
ADMIN_NAME=Praveen Kumar
```

**If using Supabase/Aiven**:
```bash
SPRING_PROFILES_ACTIVE=prod
DATABASE_URL=jdbc:postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require
JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT
FRONTEND_URL=https://talking-canvas-ws.vercel.app
ADMIN_EMAIL=pkumar.mail@gmail.com
ADMIN_PASSWORD=Admin@1998
ADMIN_NAME=Praveen Kumar
```

### Step 3.6: Deploy

1. Railway auto-deploys on GitHub push
2. Monitor logs: Click service ‚Üí **"Deployments"** ‚Üí Latest deployment
3. Wait 5-10 minutes for first build

### Step 3.7: Get Your URL

1. Go to **"Settings"** tab
2. Scroll to **"Networking"**
3. Click **"Generate Domain"**
4. Railway gives you: `https://your-app-production.up.railway.app`

### Step 3.8: Test Deployment

Visit: `https://your-app-production.up.railway.app/api/actuator/health`

**Expected response**:
```json
{"status":"UP"}
```

---

## 4. Deployment to Render

### Step 4.1: Prerequisites
- ‚úÖ Code pushed to GitHub
- ‚úÖ Render account (sign up at render.com)
- ‚úÖ PostgreSQL ready (Supabase or Aiven) OR use Render's PostgreSQL

### Step 4.2: Create PostgreSQL (Optional - if not using Supabase/Aiven)

1. Go to **https://dashboard.render.com**
2. Click **"New +"** ‚Üí **"PostgreSQL"**
3. Fill in details:
   - **Name**: `talkingcanvas-db`
   - **Database**: `talkingcanvas`
   - **User**: `talkingcanvas`
   - **Region**: Choose closest
   - **Plan**: **Free** ($0/month, 90 days free, 1 GB storage)
4. Click **"Create Database"**
5. Wait 2-3 minutes

**Save these values** from database dashboard:
```
Internal Database URL: postgresql://talkingcanvas:[PASSWORD]@[HOST]/talkingcanvas
External Database URL: (for external access)
```

### Step 4.3: Create Web Service

1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub repository: **`TalkingCanvas-ws`**
3. Fill in configuration:

```
Name: talkingcanvas-backend
Region: [Choose closest to PostgreSQL]
Branch: main
Root Directory: [leave empty]
Runtime: Java
Build Command: ./mvnw clean package -DskipTests
Start Command: java -Xmx512m -Dserver.port=$PORT -Dspring.profiles.active=prod -jar target/talkingCanvas-0.0.1-SNAPSHOT.jar
```

4. Click **"Advanced"** ‚Üí Set instance type: **Free** (512 MB RAM, 0.1 CPU)

### Step 4.4: Environment Variables

Click **"Environment"** tab and add:

**If using Render PostgreSQL**:
```bash
SPRING_PROFILES_ACTIVE=prod
DATABASE_URL=[Copy from Render PostgreSQL "Internal Database URL"]
JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT
FRONTEND_URL=https://talking-canvas-ws.vercel.app
ADMIN_EMAIL=pkumar.mail@gmail.com
ADMIN_PASSWORD=Admin@1998
ADMIN_NAME=Praveen Kumar
```

**If using Supabase/Aiven**:
```bash
SPRING_PROFILES_ACTIVE=prod
DATABASE_URL=jdbc:postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require
JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT
FRONTEND_URL=https://talking-canvas-ws.vercel.app
ADMIN_EMAIL=pkumar.mail@gmail.com
ADMIN_PASSWORD=Admin@1998
ADMIN_NAME=Praveen Kumar
```

### Step 4.5: Deploy

1. Click **"Create Web Service"**
2. Render starts building (10-15 minutes first time)
3. Monitor logs in real-time

### Step 4.6: Get Your URL

Your service URL: `https://talkingcanvas-backend.onrender.com`

### Step 4.7: Test

Visit: `https://talkingcanvas-backend.onrender.com/api/actuator/health`

**Expected**: `{"status":"UP"}`

---

## 5. Deployment to Koyeb

### Step 5.1: Prerequisites
- ‚úÖ Code pushed to GitHub
- ‚úÖ Koyeb account (sign up at koyeb.com)
- ‚úÖ PostgreSQL from Supabase or Aiven (Koyeb doesn't provide free database)

### Step 5.2: Create New App

1. Go to **https://app.koyeb.com**
2. Click **"Create App"**
3. Select **"GitHub"**
4. Choose repository: **`TalkingCanvas-ws`**
5. Builder: **Buildpack**

### Step 5.3: Configuration

```
App name: talkingcanvas
Branch: main
Build command: ./mvnw clean package -DskipTests
Run command: java -Xmx512m -Dserver.port=$PORT -Dspring.profiles.active=prod -jar target/talkingCanvas-0.0.1-SNAPSHOT.jar
```

### Step 5.4: Environment Variables

Click **"Advanced"** ‚Üí **"Environment variables"**:

```bash
SPRING_PROFILES_ACTIVE=prod
DATABASE_URL=jdbc:postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require
JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT
FRONTEND_URL=https://talking-canvas-ws.vercel.app
ADMIN_EMAIL=pkumar.mail@gmail.com
ADMIN_PASSWORD=Admin@1998
ADMIN_NAME=Praveen Kumar
PORT=8080
```

### Step 5.5: Deploy

1. Click **"Deploy"**
2. Wait 10-15 minutes for build
3. Koyeb gives you: `https://talkingcanvas-[random].koyeb.app`

### Step 5.6: Test

Visit: `https://talkingcanvas-[random].koyeb.app/api/actuator/health`

---

## 6. Deployment to Google Cloud Run

### Step 6.1: Prerequisites
- ‚úÖ Google Cloud account (free tier: $300 credit)
- ‚úÖ PostgreSQL from Supabase/Aiven OR Google Cloud SQL
- ‚úÖ Docker installed locally
- ‚úÖ gcloud CLI installed ([install guide](https://cloud.google.com/sdk/docs/install))

### Step 6.2: Setup Google Cloud Project

```bash
# Login
gcloud auth login

# Create project
gcloud projects create talkingcanvas-prod --name="TalkingCanvas"

# Set project
gcloud config set project talkingcanvas-prod

# Enable required APIs
gcloud services enable run.googleapis.com
gcloud services enable containerregistry.googleapis.com
```

### Step 6.3: Build and Push Container

```bash
# Navigate to project
cd /home/sumit/Desktop/tc-git/TalkingCanvas-ws

# Build Docker image
docker build -t gcr.io/talkingcanvas-prod/backend:latest .

# Push to Google Container Registry
docker push gcr.io/talkingcanvas-prod/backend:latest
```

### Step 6.4: Deploy to Cloud Run

```bash
gcloud run deploy talkingcanvas-backend \
  --image gcr.io/talkingcanvas-prod/backend:latest \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --memory 512Mi \
  --set-env-vars "SPRING_PROFILES_ACTIVE=prod,DATABASE_URL=jdbc:postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require,JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT,FRONTEND_URL=https://talking-canvas-ws.vercel.app,ADMIN_EMAIL=pkumar.mail@gmail.com,ADMIN_PASSWORD=Admin@1998,ADMIN_NAME=Praveen Kumar"
```

### Step 6.5: Get URL

After deployment:
```
Service URL: https://talkingcanvas-backend-[hash]-uc.a.run.app
```

### Step 6.6: Test

Visit: `https://talkingcanvas-backend-[hash]-uc.a.run.app/api/actuator/health`

---

## 7. Deployment to Oracle Cloud

### Step 7.1: Prerequisites
- ‚úÖ Oracle Cloud account (always free tier available)
- ‚úÖ PostgreSQL from Supabase/Aiven
- ‚úÖ Oracle Cloud CLI installed

### Step 7.2: Create Compute Instance

1. Go to **https://cloud.oracle.com**
2. Navigate to **Compute** ‚Üí **Instances**
3. Click **"Create Instance"**
4. Configuration:
   - **Name**: `talkingcanvas-backend`
   - **Image**: Ubuntu 22.04
   - **Shape**: VM.Standard.E2.1.Micro (Always Free)
   - **Add SSH keys**: Upload your public key

### Step 7.3: Install Java on Instance

```bash
# SSH into instance
ssh ubuntu@[INSTANCE_IP]

# Update system
sudo apt update && sudo apt upgrade -y

# Install Java 21
sudo apt install openjdk-21-jdk -y

# Verify
java -version
```

### Step 7.4: Deploy Application

```bash
# Upload JAR
scp target/talkingCanvas-0.0.1-SNAPSHOT.jar ubuntu@[INSTANCE_IP]:~/

# SSH to instance
ssh ubuntu@[INSTANCE_IP]

# Create systemd service
sudo nano /etc/systemd/system/talkingcanvas.service
```

**Service file content**:
```ini
[Unit]
Description=TalkingCanvas Backend
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu
ExecStart=/usr/bin/java -Xmx512m -Dserver.port=8080 -Dspring.profiles.active=prod -jar talkingCanvas-0.0.1-SNAPSHOT.jar
Restart=always
Environment="DATABASE_URL=jdbc:postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require"
Environment="JWT_SECRET=TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWT"
Environment="FRONTEND_URL=https://talking-canvas-ws.vercel.app"
Environment="ADMIN_EMAIL=pkumar.mail@gmail.com"
Environment="ADMIN_PASSWORD=Admin@1998"
Environment="ADMIN_NAME=Praveen Kumar"

[Install]
WantedBy=multi-user.target
```

### Step 7.5: Start Service

```bash
# Reload systemd
sudo systemctl daemon-reload

# Enable service
sudo systemctl enable talkingcanvas

# Start service
sudo systemctl start talkingcanvas

# Check status
sudo systemctl status talkingcanvas
```

### Step 7.6: Configure Firewall

```bash
# Open port 8080
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### Step 7.7: Setup Nginx Reverse Proxy (Optional)

```bash
# Install nginx
sudo apt install nginx -y

# Configure
sudo nano /etc/nginx/sites-available/talkingcanvas
```

**Nginx config**:
```nginx
server {
    listen 80;
    server_name [YOUR_DOMAIN_OR_IP];

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

```bash
# Enable site
sudo ln -s /etc/nginx/sites-available/talkingcanvas /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## 8. Environment Variables Reference

### Complete Environment Variables Table

| Variable | Required | Default/Example | Platform | Notes |
|----------|----------|----------------|----------|-------|
| `SPRING_PROFILES_ACTIVE` | ‚úÖ Yes | `prod` | All | Activates production config |
| `DATABASE_URL` | ‚úÖ Yes | See below | All | PostgreSQL connection string |
| `JWT_SECRET` | ‚úÖ Yes | 64+ chars | All | Random secure string |
| `FRONTEND_URL` | ‚úÖ Yes | Vercel URL | All | For CORS configuration |
| `ADMIN_EMAIL` | ‚úÖ Yes | `pkumar.mail@gmail.com` | All | Admin account email |
| `ADMIN_PASSWORD` | ‚úÖ Yes | `Admin@1998` | All | Admin password |
| `ADMIN_NAME` | ‚ö†Ô∏è Optional | `Praveen Kumar` | All | Admin display name |
| `MAIL_USERNAME` | ‚ö†Ô∏è Optional | Gmail address | All | For email features |
| `MAIL_PASSWORD` | ‚ö†Ô∏è Optional | Gmail app password | All | For email features |
| `PORT` | ‚ö†Ô∏è Optional | `8080` | Koyeb | Server port |

### DATABASE_URL Format by Provider

**Supabase**:
```
jdbc:postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres?sslmode=require
```

**Aiven**:
```
jdbc:postgresql://avnadmin:[PASSWORD]@pg-xxx.aivencloud.com:12345/defaultdb?sslmode=require
```

**Railway PostgreSQL**:
```
${{Postgres.DATABASE_URL}}  (auto-provided, use reference)
```

**Render PostgreSQL**:
```
[Copy from Render dashboard "Internal Database URL"]
```

### JWT_SECRET Generation

**Generate secure random string**:
```bash
# Linux/Mac
openssl rand -base64 64

# Or use online generator
# https://www.grc.com/passwords.htm (choose 64+ chars)
```

**Example**:
```
TalkingCanvas2024SecureRandomStringMinimum64CharactersLongForJWTAuthenticationPurposes
```

---

## 9. Troubleshooting

### Issue: Database Connection Failed

**Symptoms**:
```
org.postgresql.util.PSQLException: Connection refused
```

**Solutions**:
1. ‚úÖ Verify `DATABASE_URL` is correctly formatted
2. ‚úÖ Check `?sslmode=require` is at the end
3. ‚úÖ Ensure database password has no special characters issues
4. ‚úÖ Test connection from local machine first
5. ‚úÖ For Supabase: Check project is not paused
6. ‚úÖ For Aiven: Wait 3-5 min after creation

### Issue: Build Fails "Java version mismatch"

**Solution**:
‚úÖ `system.properties` file exists with `java.runtime.version=21`

### Issue: Out of Memory Error

**Symptoms**:
```
OutOfMemoryError: Java heap space
```

**Solution**:
‚úÖ Verify `-Xmx512m` is in start command

### Issue: CORS Errors

**Symptoms**:
```
Access-Control-Allow-Origin error in browser
```

**Solution**:
1. ‚úÖ Set `FRONTEND_URL` to exact Vercel URL
2. ‚úÖ No trailing slashes in URL
3. ‚úÖ Include protocol (`https://`)

### Issue: Application Starts but Crashes

**Check logs for**:
1. Database connection errors
2. Missing environment variables
3. Port binding issues

---

## 10. Values to Remember (Checklist)

### From PostgreSQL Setup:
- [ ] Database Host
- [ ] Database Port
- [ ] Database Name
- [ ] Database Username
- [ ] Database Password
- [ ] Full DATABASE_URL

### For Deployment:
- [ ] Backend deployment URL
- [ ] Frontend deployment URL (Vercel)
- [ ] JWT_SECRET (save securely!)
- [ ] Admin email
- [ ] Admin password

### Platform-Specific:
- [ ] Railway: Service name, domain
- [ ] Render: Service URL, database name
- [ ] Koyeb: App URL
- [ ] Google Cloud: Project ID, service URL
- [ ] Oracle Cloud: Instance IP, SSH key

---

## Quick Start Recommendation

**For fastest deployment**:
1. ‚úÖ Setup Supabase PostgreSQL (5 minutes)
2. ‚úÖ Deploy backend to Railway (10 minutes)
3. ‚úÖ Deploy frontend to Vercel (5 minutes)
4. ‚úÖ Total time: ~20 minutes

**For best free tier**:
1. ‚úÖ Setup Supabase PostgreSQL
2. ‚úÖ Deploy to Render (always free)
3. ‚úÖ Deploy frontend to Vercel

---

**Last Updated**: 2025-11-29
**Project**: TalkingCanvas
**Status**: Production Ready ‚úÖ
